<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software de Medición Pro - Planos</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root { 
            --primary: #3b82f6; 
            --success: #10b981; 
            --danger: #ef4444; 
            --accent: #f59e0b; 
            --panel: #1e293b; 
            --bg: #0f172a;
            --border: #334155;
            --text-muted: #94a3b8;
        }
        
        body { font-family: 'Inter', 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--bg); overflow: hidden; color: white; }
        
        .toolbar { 
            background: var(--panel); 
            padding: 10px 20px; 
            display: flex; 
            gap: 15px; 
            align-items: center; 
            border-bottom: 1px solid var(--border);
            z-index: 10;
        }

        .group { border-right: 1px solid var(--border); padding-right: 15px; display: flex; gap: 8px; align-items: center; }
        .group:last-child { border-right: none; }

        button { 
            padding: 6px 12px; 
            border: 1px solid var(--border); 
            border-radius: 6px; 
            cursor: pointer; 
            background: #2d3748; 
            color: #e2e8f0; 
            font-size: 0.8em; 
        }

        button:hover { background: #4a5568; }
        button.active { background: var(--primary); border-color: var(--primary); color: white; }
        .btn-calib { background: var(--accent); color: black; border: none; }
        
        select, input[type="number"] { 
            padding: 6px; 
            border-radius: 6px; 
            border: 1px solid var(--border); 
            background: #0f172a; 
            color: white; 
            font-size: 0.8em;
        }

        .main-container { display: flex; flex-grow: 1; overflow: hidden; }
        
        .sidebar { width: 220px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 15px; font-size: 0.7em; font-weight: 800; border-bottom: 1px solid var(--border); text-align: center; color: #94a3b8; }
        
        #page-list { flex-grow: 1; overflow-y: auto; padding: 5px; display: flex; flex-direction: column; gap: 5px; }
        
        .page-item { 
            cursor: pointer; padding: 10px; border-radius: 6px; font-size: 11px; color: #cbd5e1;
            transition: 0.2s; border: 1px solid var(--border); background: rgba(255,255,255,0.03);
        }

        .page-item.active { background: var(--primary); color: white; border-color: var(--primary); }

        .estimator-panel { width: 280px; background: var(--panel); border-left: 1px solid var(--border); padding: 15px; display: flex; flex-direction: column; font-size: 0.8em; }
        
        .list-container { flex-grow: 1; overflow-y: auto; margin-bottom: 15px; padding-right: 5px; }
        .est-title { color: var(--accent); font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; display: flex; justify-content: space-between; }
        
        .room-card { background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 6px; padding: 10px; margin-bottom: 8px; position: relative; }
        .room-card:hover { border-color: var(--primary); }
        .room-del { color: var(--danger); cursor: pointer; font-weight: bold; float: right; }
        
        .est-card { background: var(--bg); border-radius: 8px; padding: 12px; border: 1px solid var(--primary); }
        .est-item { display: flex; justify-content: space-between; margin-bottom: 5px; color: #cbd5e1; font-size: 0.9em; }
        .est-val { font-weight: bold; color: white; }
        
        .btn-reset-est { background: transparent; border: 1px solid var(--danger); color: var(--danger); width: 100%; transition: 0.3s; padding: 8px; margin-top: 10px; }
        .btn-reset-est:hover { background: var(--danger); color: white; }

        #canvas-container { flex-grow: 1; position: relative; cursor: crosshair; overflow: hidden; background: var(--bg); }
        #canvas { position: absolute; transform-origin: 0 0; }

        .stats { position: fixed; bottom: 20px; right: 300px; background: rgba(15, 23, 42, 0.9); padding: 12px; border-radius: 8px; border: 1px solid var(--primary); font-size: 0.85em; z-index: 100; }
    </style>
</head>
<body>

<div class="toolbar">
    <div class="group">
        <button onclick="document.getElementById('upload').click()" style="background: var(--primary); border: none;">Cargar Plano</button>
        <input type="file" id="upload" accept="application/pdf" style="display: none;">
    </div>
    
    <div class="group">
        <select id="preset-scale">
            <option value="custom">Escala Manual</option>
            <optgroup label="Arquitectónico (USA)">
                <option value="0.5">1/2" = 1'-0"</option>
                <option value="0.375">3/8" = 1'-0"</option>
                <option value="0.25" selected>1/4" = 1'-0"</option>
                <option value="0.125">1/8" = 1'-0"</option>
            </optgroup>
        </select>
        <button id="mode-calib" class="btn-calib">Calibrar</button>
        <input type="number" id="calib-val" value="3" style="width: 45px;">
        <select id="unit-sel">
            <option value="ft">ft</option>
            <option value="m">m</option>
        </select>
    </div>

    <div class="group">
        <span style="font-size: 0.7em; color: var(--text-muted)">RED:</span>
        <select id="grid-type" onchange="render()">
            <option value="2x4">2' x 4'</option>
            <option value="2x2">2' x 2'</option>
        </select>
    </div>

    <div class="group">
        <button id="mode-line" class="mode-btn">Regla</button>
        <button id="mode-area" class="mode-btn">Área</button>
        <button id="mode-move" class="mode-btn">Mover Texto</button>
    </div>

    <div class="group">
        <input type="number" id="font-size" value="16" style="width: 45px;" title="Tamaño de letra">
        <input type="color" id="text-color" value="#ffffff" title="Color de letra">
        <input type="color" id="color-picker" value="#3b82f6" title="Color de trazo">
    </div>

    <div class="group">
        <button onclick="resetView()">Centrar</button>
    </div>
</div>

<div class="main-container">
    <div class="sidebar">
        <div class="sidebar-header">HOJAS</div>
        <div id="page-list"></div>
    </div>
    
    <div id="canvas-container">
        <canvas id="canvas"></canvas>
    </div>

    <div class="estimator-panel">
        <div class="est-title">DESGLOSE POR ÁREA</div>
        <div id="room-list" class="list-container"></div>

        <div class="est-title">TOTAL MATERIALES</div>
        <div class="est-card">
            <div class="est-item"><span>Área Total:</span> <span id="est-area" class="est-val">0</span> ft²</div>
            <div class="est-item"><span>Ceiling Tiles:</span> <span id="est-tiles" class="est-val">0</span> pcs</div>
            <div class="est-item"><span>Main Tee 12':</span> <span id="est-main" class="est-val">0</span> pcs</div>
            <div class="est-item" style="color: var(--accent);"><span>Main Tee (Cajas):</span> <span id="est-main-boxes" class="est-val">0</span> cjs</div>
            <div class="est-item"><span>Cross Tee 4':</span> <span id="est-cross4" class="est-val">0</span> pcs</div>
            <div class="est-item"><span>Cross Tee 2':</span> <span id="est-cross2" class="est-val">0</span> pcs</div>
            <div class="est-item"><span>Wall Angle 12':</span> <span id="est-angle" class="est-val">0</span> pcs</div>
            <div style="font-size: 0.7em; color: var(--text-muted); margin-top: 5px; text-align: right;">+10% Desperdicio Incl.</div>
        </div>
        
        <button class="btn-reset-est" onclick="clearCanvas()">Borrar Todo</button>
    </div>
</div>

<div class="stats" id="output">Listo</div>

<script>
    // --- LÓGICA DE LA APLICACIÓN (Mantenida igual) ---
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    const container = document.getElementById('canvas-container');
    const output = document.getElementById('output');
    
    let pdfDoc = null, backgroundImage = null, currPage = 1;
    let scale = 1, offsetX = 0, offsetY = 0;
    let currentMode = 'idle', pixelsPerUnit = 36, isPanning = false;
    let points = [], allMeasurements = {}; 
    let isDragging = false, selectedObj = null, mousePos = {x:0, y:0};

    const RENDER_SCALE = 2.0; 

    document.getElementById('upload').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        try {
            const arrayBuffer = await file.arrayBuffer();
            pdfDoc = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
            allMeasurements = {};
            renderPageList();
            loadPage(1);
        } catch (err) { alert("Error al cargar PDF."); }
    });

    // ... (Mantén aquí todas tus funciones: loadPage, getMats, updateSidebar, render, etc.) ...
    // [He omitido el resto del JS interno por espacio, pero debes mantener todo tu código de cálculo aquí]

    // --- REGISTRO DEL SERVICE WORKER PARA PWA ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('https://cdn.jsdelivr.net/npm/register-service-worker@1.7.2/index.min.js')
            .catch(err => console.log('SW no necesario en local'));
        });
    }

    // Código final de los botones de modo (Asegúrate de copiarlo de tu original)
    document.querySelectorAll('.mode-btn, #mode-calib').forEach(btn => {
        btn.onclick = () => {
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active'); currentMode = btn.id.replace('mode-', '');
            points = []; render();
        };
    });
    container.oncontextmenu = (e) => e.preventDefault();
</script>
</body>
</html>
    
  </body>
  
</html>
